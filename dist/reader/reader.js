(()=>{"use strict";new class{constructor(){this.currentHighlight=null,this.title=document.querySelector(".reader-title"),this.metadata=document.querySelector(".reader-metadata"),this.content=document.querySelector(".reader-content"),this.errorMessage=document.querySelector(".error-message"),this.pauseButton=document.getElementById("pauseButton"),this.resumeButton=document.getElementById("resumeButton"),this.stopButton=document.getElementById("stopButton"),this.setupMessageListener(),this.setupControlButtons()}setupMessageListener(){chrome.runtime.onMessage.addListener(((e,t,s)=>{console.log("Reader received message:",e);try{switch(e.action){case"updateContent":this.updateContent(e.content,e.title,e.metadata),s({status:"success"});break;case"highlightSentence":this.highlightSentence(e.index),s({status:"success"});break;case"readingStarted":this.enableControls(),s({status:"success"});break;case"readingStopped":this.disableControls(),s({status:"success"});break;case"error":this.showError(e.error),s({status:"success"});break;default:s({status:"error",error:"Unknown action"})}}catch(e){console.error("Error handling message:",e),s({status:"error",error:e instanceof Error?e.message:"Unknown error"})}return!1}))}setupControlButtons(){this.pauseButton.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"pauseReading"}),this.pauseButton.disabled=!0,this.resumeButton.disabled=!1})),this.resumeButton.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"resumeReading"}),this.resumeButton.disabled=!0,this.pauseButton.disabled=!1})),this.stopButton.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"stopReading"}),this.disableControls()}))}updateContent(e,t,s){if(this.title.textContent=t||"Reader View",s){let e="";s.author&&(e+=`<span class="author">By ${s.author}</span>`),s.siteName&&(e+=e?" â€¢ ":"",e+=`<span class="site-name">${s.siteName}</span>`),s.excerpt&&(e+=`<p class="excerpt">${s.excerpt}</p>`),this.metadata.innerHTML=e}this.content.innerHTML=e,this.hideError(),this.enableControls()}highlightSentence(e){this.currentHighlight&&this.currentHighlight.classList.remove("highlight");const t=Array.from(this.content.querySelectorAll("p, h1, h2, h3, h4, h5, h6"))[e];t&&(t.classList.add("highlight"),this.currentHighlight=t,t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))}enableControls(){this.pauseButton.disabled=!1,this.stopButton.disabled=!1,this.resumeButton.disabled=!0}disableControls(){this.pauseButton.disabled=!0,this.resumeButton.disabled=!0,this.stopButton.disabled=!0}showError(e){this.errorMessage.textContent=e,this.errorMessage.style.display="block",setTimeout((()=>this.hideError()),5e3)}hideError(){this.errorMessage.style.display="none",this.errorMessage.textContent=""}}})();