/*! For license information please see content.js.LICENSE.txt */
(()=>{var t={804:t=>{var e={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function r(t){return(!t.style||"none"!=t.style.display)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.indexOf&&-1!==t.className.indexOf("fallback-image"))}t.exports=function(t,n={}){"function"==typeof n&&(n={visibilityChecker:n});var i={minScore:20,minContentLength:140,visibilityChecker:r};n=Object.assign(i,n);var s=t.querySelectorAll("p, pre, article"),o=t.querySelectorAll("div > br");if(o.length){var a=new Set(s);[].forEach.call(o,(function(t){a.add(t.parentNode)})),s=Array.from(a)}var l=0;return[].some.call(s,(function(t){if(!n.visibilityChecker(t))return!1;var r=t.className+" "+t.id;if(e.unlikelyCandidates.test(r)&&!e.okMaybeItsACandidate.test(r))return!1;if(t.matches("li p"))return!1;var i=t.textContent.trim().length;return!(i<n.minContentLength)&&(l+=Math.sqrt(i-n.minContentLength))>n.minScore}))}},238:t=>{function e(t,e){if(e&&e.documentElement)t=e,e=arguments[2];else if(!t||!t.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(e=e||{},this._doc=t,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._keepClasses=!!e.keepClasses,this._serializer=e.serializer||function(t){return t.innerHTML},this._disableJSONLD=!!e.disableJSONLD,this._allowedVideoRegex=e.allowedVideoRegex||this.REGEXPS.videos,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let t=function(t){if(t.nodeType==t.TEXT_NODE)return`${t.nodeName} ("${t.textContent}")`;let e=Array.from(t.attributes||[],(function(t){return`${t.name}="${t.value}"`})).join(" ");return`<${t.localName} ${e}>`};this.log=function(){if("undefined"!=typeof console){let e=Array.from(arguments,(e=>e&&e.nodeType==this.ELEMENT_NODE?t(e):e));e.unshift("Reader: (Readability)"),console.log.apply(console,e)}else if("undefined"!=typeof dump){var e=Array.prototype.map.call(arguments,(function(e){return e&&e.nodeName?t(e):e})).join(" ");dump("Reader: (Readability) "+e+"\n")}}}else this.log=function(){}}e.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent:function(t){this._fixRelativeUris(t),this._simplifyNestedElements(t),this._keepClasses||this._cleanClasses(t)},_removeNodes:function(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var r=t.length-1;r>=0;r--){var n=t[r],i=n.parentNode;i&&(e&&!e.call(this,n,r,t)||i.removeChild(n))}},_replaceNodeTags:function(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const r of t)this._setNodeTag(r,e)},_forEachNode:function(t,e){Array.prototype.forEach.call(t,e,this)},_findNode:function(t,e){return Array.prototype.find.call(t,e,this)},_someNode:function(t,e){return Array.prototype.some.call(t,e,this)},_everyNode:function(t,e){return Array.prototype.every.call(t,e,this)},_concatNodeLists:function(){var t=Array.prototype.slice,e=t.call(arguments).map((function(e){return t.call(e)}));return Array.prototype.concat.apply([],e)},_getAllNodesWithTag:function(t,e){return t.querySelectorAll?t.querySelectorAll(e.join(",")):[].concat.apply([],e.map((function(e){var r=t.getElementsByTagName(e);return Array.isArray(r)?r:Array.from(r)})))},_cleanClasses:function(t){var e=this._classesToPreserve,r=(t.getAttribute("class")||"").split(/\s+/).filter((function(t){return-1!=e.indexOf(t)})).join(" ");for(r?t.setAttribute("class",r):t.removeAttribute("class"),t=t.firstElementChild;t;t=t.nextElementSibling)this._cleanClasses(t)},_fixRelativeUris:function(t){var e=this._doc.baseURI,r=this._doc.documentURI;function n(t){if(e==r&&"#"==t.charAt(0))return t;try{return new URL(t,e).href}catch(t){}return t}var i=this._getAllNodesWithTag(t,["a"]);this._forEachNode(i,(function(t){var e=t.getAttribute("href");if(e)if(0===e.indexOf("javascript:"))if(1===t.childNodes.length&&t.childNodes[0].nodeType===this.TEXT_NODE){var r=this._doc.createTextNode(t.textContent);t.parentNode.replaceChild(r,t)}else{for(var i=this._doc.createElement("span");t.firstChild;)i.appendChild(t.firstChild);t.parentNode.replaceChild(i,t)}else t.setAttribute("href",n(e))}));var s=this._getAllNodesWithTag(t,["img","picture","figure","video","audio","source"]);this._forEachNode(s,(function(t){var e=t.getAttribute("src"),r=t.getAttribute("poster"),i=t.getAttribute("srcset");if(e&&t.setAttribute("src",n(e)),r&&t.setAttribute("poster",n(r)),i){var s=i.replace(this.REGEXPS.srcsetUrl,(function(t,e,r,i){return n(e)+(r||"")+i}));t.setAttribute("srcset",s)}}))},_simplifyNestedElements:function(t){for(var e=t;e;){if(e.parentNode&&["DIV","SECTION"].includes(e.tagName)&&(!e.id||!e.id.startsWith("readability"))){if(this._isElementWithoutContent(e)){e=this._removeAndGetNext(e);continue}if(this._hasSingleTagInsideElement(e,"DIV")||this._hasSingleTagInsideElement(e,"SECTION")){for(var r=e.children[0],n=0;n<e.attributes.length;n++)r.setAttribute(e.attributes[n].name,e.attributes[n].value);e.parentNode.replaceChild(r,e),e=r;continue}}e=this._getNextNode(e)}},_getArticleTitle:function(){var t=this._doc,e="",r="";try{"string"!=typeof(e=r=t.title.trim())&&(e=r=this._getInnerText(t.getElementsByTagName("title")[0]))}catch(t){}var n=!1;function i(t){return t.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(e))n=/ [\\\/>»] /.test(e),i(e=r.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"))<3&&(e=r.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(-1!==e.indexOf(": ")){var s=this._concatNodeLists(t.getElementsByTagName("h1"),t.getElementsByTagName("h2")),o=e.trim();this._someNode(s,(function(t){return t.textContent.trim()===o}))||(i(e=r.substring(r.lastIndexOf(":")+1))<3?e=r.substring(r.indexOf(":")+1):i(r.substr(0,r.indexOf(":")))>5&&(e=r))}else if(e.length>150||e.length<15){var a=t.getElementsByTagName("h1");1===a.length&&(e=this._getInnerText(a[0]))}var l=i(e=e.trim().replace(this.REGEXPS.normalize," "));return l<=4&&(!n||l!=i(r.replace(/[\|\-\\\/>»]+/g,""))-1)&&(e=r),e},_prepDocument:function(){var t=this._doc;this._removeNodes(this._getAllNodesWithTag(t,["style"])),t.body&&this._replaceBrs(t.body),this._replaceNodeTags(this._getAllNodesWithTag(t,["font"]),"SPAN")},_nextNode:function(t){for(var e=t;e&&e.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs:function(t){this._forEachNode(this._getAllNodesWithTag(t,["br"]),(function(t){for(var e=t.nextSibling,r=!1;(e=this._nextNode(e))&&"BR"==e.tagName;){r=!0;var n=e.nextSibling;e.parentNode.removeChild(e),e=n}if(r){var i=this._doc.createElement("p");for(t.parentNode.replaceChild(i,t),e=i.nextSibling;e;){if("BR"==e.tagName){var s=this._nextNode(e.nextSibling);if(s&&"BR"==s.tagName)break}if(!this._isPhrasingContent(e))break;var o=e.nextSibling;i.appendChild(e),e=o}for(;i.lastChild&&this._isWhitespace(i.lastChild);)i.removeChild(i.lastChild);"P"===i.parentNode.tagName&&this._setNodeTag(i.parentNode,"DIV")}}))},_setNodeTag:function(t,e){if(this.log("_setNodeTag",t,e),this._docJSDOMParser)return t.localName=e.toLowerCase(),t.tagName=e.toUpperCase(),t;for(var r=t.ownerDocument.createElement(e);t.firstChild;)r.appendChild(t.firstChild);t.parentNode.replaceChild(r,t),t.readability&&(r.readability=t.readability);for(var n=0;n<t.attributes.length;n++)try{r.setAttribute(t.attributes[n].name,t.attributes[n].value)}catch(t){}return r},_prepArticle:function(t){this._cleanStyles(t),this._markDataTables(t),this._fixLazyImages(t),this._cleanConditionally(t,"form"),this._cleanConditionally(t,"fieldset"),this._clean(t,"object"),this._clean(t,"embed"),this._clean(t,"footer"),this._clean(t,"link"),this._clean(t,"aside");var e=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(t.children,(function(t){this._cleanMatchedNodes(t,(function(t,r){return this.REGEXPS.shareElements.test(r)&&t.textContent.length<e}))})),this._clean(t,"iframe"),this._clean(t,"input"),this._clean(t,"textarea"),this._clean(t,"select"),this._clean(t,"button"),this._cleanHeaders(t),this._cleanConditionally(t,"table"),this._cleanConditionally(t,"ul"),this._cleanConditionally(t,"div"),this._replaceNodeTags(this._getAllNodesWithTag(t,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(t,["p"]),(function(t){return 0===t.getElementsByTagName("img").length+t.getElementsByTagName("embed").length+t.getElementsByTagName("object").length+t.getElementsByTagName("iframe").length&&!this._getInnerText(t,!1)})),this._forEachNode(this._getAllNodesWithTag(t,["br"]),(function(t){var e=this._nextNode(t.nextSibling);e&&"P"==e.tagName&&t.parentNode.removeChild(t)})),this._forEachNode(this._getAllNodesWithTag(t,["table"]),(function(t){var e=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(e,"TR")){var r=e.firstElementChild;if(this._hasSingleTagInsideElement(r,"TD")){var n=r.firstElementChild;n=this._setNodeTag(n,this._everyNode(n.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(n,t)}}}))},_initializeNode:function(t){switch(t.readability={contentScore:0},t.tagName){case"DIV":t.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":t.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":t.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":t.readability.contentScore-=5}t.readability.contentScore+=this._getClassWeight(t)},_removeAndGetNext:function(t){var e=this._getNextNode(t,!0);return t.parentNode.removeChild(t),e},_getNextNode:function(t,e){if(!e&&t.firstElementChild)return t.firstElementChild;if(t.nextElementSibling)return t.nextElementSibling;do{t=t.parentNode}while(t&&!t.nextElementSibling);return t&&t.nextElementSibling},_textSimilarity:function(t,e){var r=t.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),n=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);return r.length&&n.length?1-n.filter((t=>!r.includes(t))).join(" ").length/n.join(" ").length:0},_checkByline:function(t,e){if(this._articleByline)return!1;if(void 0!==t.getAttribute)var r=t.getAttribute("rel"),n=t.getAttribute("itemprop");return!(!("author"===r||n&&-1!==n.indexOf("author")||this.REGEXPS.byline.test(e))||!this._isValidByline(t.textContent)||(this._articleByline=t.textContent.trim(),0))},_getNodeAncestors:function(t,e){e=e||0;for(var r=0,n=[];t.parentNode&&(n.push(t.parentNode),!e||++r!==e);)t=t.parentNode;return n},_grabArticle:function(t){this.log("**** grabArticle ****");var e=this._doc,r=null!==t;if(!(t=t||this._doc.body))return this.log("No body found in document. Abort."),null;for(var n=t.innerHTML;;){this.log("Starting grabArticle loop");var i=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),s=[],o=this._doc.documentElement;let V=!0;for(;o;){"HTML"===o.tagName&&(this._articleLang=o.getAttribute("lang"));var a=o.className+" "+o.id;if(this._isProbablyVisible(o))if("true"!=o.getAttribute("aria-modal")||"dialog"!=o.getAttribute("role"))if(this._checkByline(o,a))o=this._removeAndGetNext(o);else if(V&&this._headerDuplicatesTitle(o))this.log("Removing header: ",o.textContent.trim(),this._articleTitle.trim()),V=!1,o=this._removeAndGetNext(o);else{if(i){if(this.REGEXPS.unlikelyCandidates.test(a)&&!this.REGEXPS.okMaybeItsACandidate.test(a)&&!this._hasAncestorTag(o,"table")&&!this._hasAncestorTag(o,"code")&&"BODY"!==o.tagName&&"A"!==o.tagName){this.log("Removing unlikely candidate - "+a),o=this._removeAndGetNext(o);continue}if(this.UNLIKELY_ROLES.includes(o.getAttribute("role"))){this.log("Removing content with role "+o.getAttribute("role")+" - "+a),o=this._removeAndGetNext(o);continue}}if("DIV"!==o.tagName&&"SECTION"!==o.tagName&&"HEADER"!==o.tagName&&"H1"!==o.tagName&&"H2"!==o.tagName&&"H3"!==o.tagName&&"H4"!==o.tagName&&"H5"!==o.tagName&&"H6"!==o.tagName||!this._isElementWithoutContent(o)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(o.tagName)&&s.push(o),"DIV"===o.tagName){for(var l=null,h=o.firstChild;h;){var c=h.nextSibling;if(this._isPhrasingContent(h))null!==l?l.appendChild(h):this._isWhitespace(h)||(l=e.createElement("p"),o.replaceChild(l,h),l.appendChild(h));else if(null!==l){for(;l.lastChild&&this._isWhitespace(l.lastChild);)l.removeChild(l.lastChild);l=null}h=c}if(this._hasSingleTagInsideElement(o,"P")&&this._getLinkDensity(o)<.25){var u=o.children[0];o.parentNode.replaceChild(u,o),o=u,s.push(o)}else this._hasChildBlockElement(o)||(o=this._setNodeTag(o,"P"),s.push(o))}o=this._getNextNode(o)}else o=this._removeAndGetNext(o)}else o=this._removeAndGetNext(o);else this.log("Removing hidden node - "+a),o=this._removeAndGetNext(o)}var f=[];this._forEachNode(s,(function(t){if(t.parentNode&&void 0!==t.parentNode.tagName){var e=this._getInnerText(t);if(!(e.length<25)){var r=this._getNodeAncestors(t,5);if(0!==r.length){var n=0;n+=1,n+=e.split(this.REGEXPS.commas).length,n+=Math.min(Math.floor(e.length/100),3),this._forEachNode(r,(function(t,e){if(t.tagName&&t.parentNode&&void 0!==t.parentNode.tagName){if(void 0===t.readability&&(this._initializeNode(t),f.push(t)),0===e)var r=1;else r=1===e?2:3*e;t.readability.contentScore+=n/r}}))}}}}));for(var d=[],g=0,p=f.length;g<p;g+=1){var m=f[g],y=m.readability.contentScore*(1-this._getLinkDensity(m));m.readability.contentScore=y,this.log("Candidate:",m,"with score "+y);for(var E=0;E<this._nbTopCandidates;E++){var _=d[E];if(!_||y>_.readability.contentScore){d.splice(E,0,m),d.length>this._nbTopCandidates&&d.pop();break}}}var b,N=d[0]||null,T=!1;if(null===N||"BODY"===N.tagName){for(N=e.createElement("DIV"),T=!0;t.firstChild;)this.log("Moving child out:",t.firstChild),N.appendChild(t.firstChild);t.appendChild(N),this._initializeNode(N)}else if(N){for(var v=[],A=1;A<d.length;A++)d[A].readability.contentScore/N.readability.contentScore>=.75&&v.push(this._getNodeAncestors(d[A]));if(v.length>=3)for(b=N.parentNode;"BODY"!==b.tagName;){for(var w=0,S=0;S<v.length&&w<3;S++)w+=Number(v[S].includes(b));if(w>=3){N=b;break}b=b.parentNode}N.readability||this._initializeNode(N),b=N.parentNode;for(var C=N.readability.contentScore,x=C/3;"BODY"!==b.tagName;)if(b.readability){var I=b.readability.contentScore;if(I<x)break;if(I>C){N=b;break}C=b.readability.contentScore,b=b.parentNode}else b=b.parentNode;for(b=N.parentNode;"BODY"!=b.tagName&&1==b.children.length;)b=(N=b).parentNode;N.readability||this._initializeNode(N)}var L=e.createElement("DIV");r&&(L.id="readability-content");for(var R=Math.max(10,.2*N.readability.contentScore),B=(b=N.parentNode).children,O=0,P=B.length;O<P;O++){var U=B[O],D=!1;if(this.log("Looking at sibling node:",U,U.readability?"with score "+U.readability.contentScore:""),this.log("Sibling has score",U.readability?U.readability.contentScore:"Unknown"),U===N)D=!0;else{var M=0;if(U.className===N.className&&""!==N.className&&(M+=.2*N.readability.contentScore),U.readability&&U.readability.contentScore+M>=R)D=!0;else if("P"===U.nodeName){var k=this._getLinkDensity(U),F=this._getInnerText(U),G=F.length;(G>80&&k<.25||G<80&&G>0&&0===k&&-1!==F.search(/\.( |$)/))&&(D=!0)}}D&&(this.log("Appending node:",U),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(U.nodeName)&&(this.log("Altering sibling:",U,"to div."),U=this._setNodeTag(U,"DIV")),L.appendChild(U),B=b.children,O-=1,P-=1)}if(this._debug&&this.log("Article content pre-prep: "+L.innerHTML),this._prepArticle(L),this._debug&&this.log("Article content post-prep: "+L.innerHTML),T)N.id="readability-page-1",N.className="page";else{var H=e.createElement("DIV");for(H.id="readability-page-1",H.className="page";L.firstChild;)H.appendChild(L.firstChild);L.appendChild(H)}this._debug&&this.log("Article content after paging: "+L.innerHTML);var $=!0,j=this._getInnerText(L,!0).length;if(j<this._charThreshold)if($=!1,t.innerHTML=n,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:L,textLength:j});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:L,textLength:j});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:L,textLength:j});else{if(this._attempts.push({articleContent:L,textLength:j}),this._attempts.sort((function(t,e){return e.textLength-t.textLength})),!this._attempts[0].textLength)return null;L=this._attempts[0].articleContent,$=!0}if($){var W=[b,N].concat(this._getNodeAncestors(b));return this._someNode(W,(function(t){if(!t.tagName)return!1;var e=t.getAttribute("dir");return!!e&&(this._articleDir=e,!0)})),L}}},_isValidByline:function(t){return("string"==typeof t||t instanceof String)&&(t=t.trim()).length>0&&t.length<100},_unescapeHtmlEntities:function(t){if(!t)return t;var e=this.HTML_ESCAPE_MAP;return t.replace(/&(quot|amp|apos|lt|gt);/g,(function(t,r){return e[r]})).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi,(function(t,e,r){var n=parseInt(e||r,e?16:10);return String.fromCharCode(n)}))},_getJSONLD:function(t){var e,r=this._getAllNodesWithTag(t,["script"]);return this._forEachNode(r,(function(t){if(!e&&"application/ld+json"===t.getAttribute("type"))try{var r=t.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),n=JSON.parse(r);if(!n["@context"]||!n["@context"].match(/^https?\:\/\/schema\.org$/))return;if(!n["@type"]&&Array.isArray(n["@graph"])&&(n=n["@graph"].find((function(t){return(t["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)}))),!n||!n["@type"]||!n["@type"].match(this.REGEXPS.jsonLdArticleTypes))return;if(e={},"string"==typeof n.name&&"string"==typeof n.headline&&n.name!==n.headline){var i=this._getArticleTitle(),s=this._textSimilarity(n.name,i)>.75,o=this._textSimilarity(n.headline,i)>.75;e.title=o&&!s?n.headline:n.name}else"string"==typeof n.name?e.title=n.name.trim():"string"==typeof n.headline&&(e.title=n.headline.trim());return n.author&&("string"==typeof n.author.name?e.byline=n.author.name.trim():Array.isArray(n.author)&&n.author[0]&&"string"==typeof n.author[0].name&&(e.byline=n.author.filter((function(t){return t&&"string"==typeof t.name})).map((function(t){return t.name.trim()})).join(", "))),"string"==typeof n.description&&(e.excerpt=n.description.trim()),n.publisher&&"string"==typeof n.publisher.name&&(e.siteName=n.publisher.name.trim()),void("string"==typeof n.datePublished&&(e.datePublished=n.datePublished.trim()))}catch(t){this.log(t.message)}})),e||{}},_getArticleMetadata:function(t){var e={},r={},n=this._doc.getElementsByTagName("meta"),i=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,s=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(n,(function(t){var e=t.getAttribute("name"),n=t.getAttribute("property"),o=t.getAttribute("content");if(o){var a=null,l=null;n&&(a=n.match(i))&&(l=a[0].toLowerCase().replace(/\s/g,""),r[l]=o.trim()),!a&&e&&s.test(e)&&(l=e,o&&(l=l.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),r[l]=o.trim()))}})),e.title=t.title||r["dc:title"]||r["dcterm:title"]||r["og:title"]||r["weibo:article:title"]||r["weibo:webpage:title"]||r.title||r["twitter:title"],e.title||(e.title=this._getArticleTitle()),e.byline=t.byline||r["dc:creator"]||r["dcterm:creator"]||r.author,e.excerpt=t.excerpt||r["dc:description"]||r["dcterm:description"]||r["og:description"]||r["weibo:article:description"]||r["weibo:webpage:description"]||r.description||r["twitter:description"],e.siteName=t.siteName||r["og:site_name"],e.publishedTime=t.datePublished||r["article:published_time"]||null,e.title=this._unescapeHtmlEntities(e.title),e.byline=this._unescapeHtmlEntities(e.byline),e.excerpt=this._unescapeHtmlEntities(e.excerpt),e.siteName=this._unescapeHtmlEntities(e.siteName),e.publishedTime=this._unescapeHtmlEntities(e.publishedTime),e},_isSingleImage:function(t){return"IMG"===t.tagName||1===t.children.length&&""===t.textContent.trim()&&this._isSingleImage(t.children[0])},_unwrapNoscriptImages:function(t){var e=Array.from(t.getElementsByTagName("img"));this._forEachNode(e,(function(t){for(var e=0;e<t.attributes.length;e++){var r=t.attributes[e];switch(r.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(r.value))return}t.parentNode.removeChild(t)}));var r=Array.from(t.getElementsByTagName("noscript"));this._forEachNode(r,(function(e){var r=t.createElement("div");if(r.innerHTML=e.innerHTML,this._isSingleImage(r)){var n=e.previousElementSibling;if(n&&this._isSingleImage(n)){var i=n;"IMG"!==i.tagName&&(i=n.getElementsByTagName("img")[0]);for(var s=r.getElementsByTagName("img")[0],o=0;o<i.attributes.length;o++){var a=i.attributes[o];if(""!==a.value&&("src"===a.name||"srcset"===a.name||/\.(jpg|jpeg|png|webp)/i.test(a.value))){if(s.getAttribute(a.name)===a.value)continue;var l=a.name;s.hasAttribute(l)&&(l="data-old-"+l),s.setAttribute(l,a.value)}}e.parentNode.replaceChild(r.firstElementChild,n)}}}))},_removeScripts:function(t){this._removeNodes(this._getAllNodesWithTag(t,["script","noscript"]))},_hasSingleTagInsideElement:function(t,e){return 1==t.children.length&&t.children[0].tagName===e&&!this._someNode(t.childNodes,(function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)}))},_isElementWithoutContent:function(t){return t.nodeType===this.ELEMENT_NODE&&0==t.textContent.trim().length&&(0==t.children.length||t.children.length==t.getElementsByTagName("br").length+t.getElementsByTagName("hr").length)},_hasChildBlockElement:function(t){return this._someNode(t.childNodes,(function(t){return this.DIV_TO_P_ELEMS.has(t.tagName)||this._hasChildBlockElement(t)}))},_isPhrasingContent:function(t){return t.nodeType===this.TEXT_NODE||-1!==this.PHRASING_ELEMS.indexOf(t.tagName)||("A"===t.tagName||"DEL"===t.tagName||"INS"===t.tagName)&&this._everyNode(t.childNodes,this._isPhrasingContent)},_isWhitespace:function(t){return t.nodeType===this.TEXT_NODE&&0===t.textContent.trim().length||t.nodeType===this.ELEMENT_NODE&&"BR"===t.tagName},_getInnerText:function(t,e){e=void 0===e||e;var r=t.textContent.trim();return e?r.replace(this.REGEXPS.normalize," "):r},_getCharCount:function(t,e){return e=e||",",this._getInnerText(t).split(e).length-1},_cleanStyles:function(t){if(t&&"svg"!==t.tagName.toLowerCase()){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)t.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);-1!==this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(t.tagName)&&(t.removeAttribute("width"),t.removeAttribute("height"));for(var r=t.firstElementChild;null!==r;)this._cleanStyles(r),r=r.nextElementSibling}},_getLinkDensity:function(t){var e=this._getInnerText(t).length;if(0===e)return 0;var r=0;return this._forEachNode(t.getElementsByTagName("a"),(function(t){var e=t.getAttribute("href"),n=e&&this.REGEXPS.hashUrl.test(e)?.3:1;r+=this._getInnerText(t).length*n})),r/e},_getClassWeight:function(t){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0;return"string"==typeof t.className&&""!==t.className&&(this.REGEXPS.negative.test(t.className)&&(e-=25),this.REGEXPS.positive.test(t.className)&&(e+=25)),"string"==typeof t.id&&""!==t.id&&(this.REGEXPS.negative.test(t.id)&&(e-=25),this.REGEXPS.positive.test(t.id)&&(e+=25)),e},_clean:function(t,e){var r=-1!==["object","embed","iframe"].indexOf(e);this._removeNodes(this._getAllNodesWithTag(t,[e]),(function(t){if(r){for(var e=0;e<t.attributes.length;e++)if(this._allowedVideoRegex.test(t.attributes[e].value))return!1;if("object"===t.tagName&&this._allowedVideoRegex.test(t.innerHTML))return!1}return!0}))},_hasAncestorTag:function(t,e,r,n){r=r||3,e=e.toUpperCase();for(var i=0;t.parentNode;){if(r>0&&i>r)return!1;if(t.parentNode.tagName===e&&(!n||n(t.parentNode)))return!0;t=t.parentNode,i++}return!1},_getRowAndColumnCount:function(t){for(var e=0,r=0,n=t.getElementsByTagName("tr"),i=0;i<n.length;i++){var s=n[i].getAttribute("rowspan")||0;s&&(s=parseInt(s,10)),e+=s||1;for(var o=0,a=n[i].getElementsByTagName("td"),l=0;l<a.length;l++){var h=a[l].getAttribute("colspan")||0;h&&(h=parseInt(h,10)),o+=h||1}r=Math.max(r,o)}return{rows:e,columns:r}},_markDataTables:function(t){for(var e=t.getElementsByTagName("table"),r=0;r<e.length;r++){var n=e[r];if("presentation"!=n.getAttribute("role"))if("0"!=n.getAttribute("datatable"))if(n.getAttribute("summary"))n._readabilityDataTable=!0;else{var i=n.getElementsByTagName("caption")[0];if(i&&i.childNodes.length>0)n._readabilityDataTable=!0;else if(["col","colgroup","tfoot","thead","th"].some((function(t){return!!n.getElementsByTagName(t)[0]})))this.log("Data table because found data-y descendant"),n._readabilityDataTable=!0;else if(n.getElementsByTagName("table")[0])n._readabilityDataTable=!1;else{var s=this._getRowAndColumnCount(n);s.rows>=10||s.columns>4?n._readabilityDataTable=!0:n._readabilityDataTable=s.rows*s.columns>10}}else n._readabilityDataTable=!1;else n._readabilityDataTable=!1}},_fixLazyImages:function(t){this._forEachNode(this._getAllNodesWithTag(t,["img","picture","figure"]),(function(t){if(t.src&&this.REGEXPS.b64DataUrl.test(t.src)){if("image/svg+xml"===this.REGEXPS.b64DataUrl.exec(t.src)[1])return;for(var e=!1,r=0;r<t.attributes.length;r++){var n=t.attributes[r];if("src"!==n.name&&/\.(jpg|jpeg|png|webp)/i.test(n.value)){e=!0;break}}if(e){var i=t.src.search(/base64\s*/i)+7;t.src.length-i<133&&t.removeAttribute("src")}}if(!(t.src||t.srcset&&"null"!=t.srcset)||-1!==t.className.toLowerCase().indexOf("lazy"))for(var s=0;s<t.attributes.length;s++)if("src"!==(n=t.attributes[s]).name&&"srcset"!==n.name&&"alt"!==n.name){var o=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(n.value)?o="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(n.value)&&(o="src"),o)if("IMG"===t.tagName||"PICTURE"===t.tagName)t.setAttribute(o,n.value);else if("FIGURE"===t.tagName&&!this._getAllNodesWithTag(t,["img","picture"]).length){var a=this._doc.createElement("img");a.setAttribute(o,n.value),t.appendChild(a)}}}))},_getTextDensity:function(t,e){var r=this._getInnerText(t,!0).length;if(0===r)return 0;var n=0,i=this._getAllNodesWithTag(t,e);return this._forEachNode(i,(t=>n+=this._getInnerText(t,!0).length)),n/r},_cleanConditionally:function(t,e){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(t,[e]),(function(t){var r=function(t){return t._readabilityDataTable},n="ul"===e||"ol"===e;if(!n){var i=0,s=this._getAllNodesWithTag(t,["ul","ol"]);this._forEachNode(s,(t=>i+=this._getInnerText(t).length)),n=i/this._getInnerText(t).length>.9}if("table"===e&&r(t))return!1;if(this._hasAncestorTag(t,"table",-1,r))return!1;if(this._hasAncestorTag(t,"code"))return!1;var o=this._getClassWeight(t);if(this.log("Cleaning Conditionally",t),o+0<0)return!0;if(this._getCharCount(t,",")<10){for(var a=t.getElementsByTagName("p").length,l=t.getElementsByTagName("img").length,h=t.getElementsByTagName("li").length-100,c=t.getElementsByTagName("input").length,u=this._getTextDensity(t,["h1","h2","h3","h4","h5","h6"]),f=0,d=this._getAllNodesWithTag(t,["object","embed","iframe"]),g=0;g<d.length;g++){for(var p=0;p<d[g].attributes.length;p++)if(this._allowedVideoRegex.test(d[g].attributes[p].value))return!1;if("object"===d[g].tagName&&this._allowedVideoRegex.test(d[g].innerHTML))return!1;f++}var m=this._getLinkDensity(t),y=this._getInnerText(t).length,E=l>1&&a/l<.5&&!this._hasAncestorTag(t,"figure")||!n&&h>a||c>Math.floor(a/3)||!n&&u<.9&&y<25&&(0===l||l>2)&&!this._hasAncestorTag(t,"figure")||!n&&o<25&&m>.2||o>=25&&m>.5||1===f&&y<75||f>1;if(n&&E){for(var _=0;_<t.children.length;_++)if(t.children[_].children.length>1)return E;if(l==t.getElementsByTagName("li").length)return!1}return E}return!1}))},_cleanMatchedNodes:function(t,e){for(var r=this._getNextNode(t,!0),n=this._getNextNode(t);n&&n!=r;)n=e.call(this,n,n.className+" "+n.id)?this._removeAndGetNext(n):this._getNextNode(n)},_cleanHeaders:function(t){let e=this._getAllNodesWithTag(t,["h1","h2"]);this._removeNodes(e,(function(t){let e=this._getClassWeight(t)<0;return e&&this.log("Removing header with low class weight:",t),e}))},_headerDuplicatesTitle:function(t){if("H1"!=t.tagName&&"H2"!=t.tagName)return!1;var e=this._getInnerText(t,!1);return this.log("Evaluating similarity of header:",e,this._articleTitle),this._textSimilarity(this._articleTitle,e)>.75},_flagIsActive:function(t){return(this._flags&t)>0},_removeFlag:function(t){this._flags=this._flags&~t},_isProbablyVisible:function(t){return(!t.style||"none"!=t.style.display)&&(!t.style||"hidden"!=t.style.visibility)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.indexOf&&-1!==t.className.indexOf("fallback-image"))},parse:function(){if(this._maxElemsToParse>0){var t=this._doc.getElementsByTagName("*").length;if(t>this._maxElemsToParse)throw new Error("Aborting parsing document; "+t+" elements found")}this._unwrapNoscriptImages(this._doc);var e=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var r=this._getArticleMetadata(e);this._articleTitle=r.title;var n=this._grabArticle();if(!n)return null;if(this.log("Grabbed: "+n.innerHTML),this._postProcessContent(n),!r.excerpt){var i=n.getElementsByTagName("p");i.length>0&&(r.excerpt=i[0].textContent.trim())}var s=n.textContent;return{title:this._articleTitle,byline:r.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(n),textContent:s,length:s.length,excerpt:r.excerpt,siteName:r.siteName||this._articleSiteName,publishedTime:r.publishedTime}}},t.exports=e},396:(t,e,r)=>{var n=r(238),i=r(804);t.exports={Readability:n,isProbablyReaderable:i}},526:(t,e)=>{"use strict";e.byteLength=function(t){var e=a(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,s=a(t),o=s[0],l=s[1],h=new i(function(t,e,r){return 3*(e+r)/4-r}(0,o,l)),c=0,u=l>0?o-4:o;for(r=0;r<u;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],h[c++]=e>>16&255,h[c++]=e>>8&255,h[c++]=255&e;return 2===l&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,h[c++]=255&e),1===l&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,h[c++]=e>>8&255,h[c++]=255&e),h},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=16383,a=0,h=n-i;a<h;a+=o)s.push(l(t,a,a+o>h?h:a+o));return 1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function l(t,e,n){for(var i,s,o=[],a=e;a<n;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},287:(t,e,r)=>{"use strict";const n=r(526),i=r(251),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=function(t){return+t!=t&&(t=0),l.alloc(+t)},e.INSPECT_MAX_BYTES=50;const o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,l.prototype),e}function l(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return u(t)}return h(t,e,r)}function h(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|p(t,e);let n=a(r);const i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(q(t,Uint8Array)){const e=new Uint8Array(t);return d(e.buffer,e.byteOffset,e.byteLength)}return f(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(q(t,ArrayBuffer)||t&&q(t.buffer,ArrayBuffer))return d(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(q(t,SharedArrayBuffer)||t&&q(t.buffer,SharedArrayBuffer)))return d(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return l.from(n,e,r);const i=function(t){if(l.isBuffer(t)){const e=0|g(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||K(t.length)?a(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return c(t),a(t<0?0:0|g(t))}function f(t){const e=t.length<0?0:0|g(t.length),r=a(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function d(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,l.prototype),n}function g(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function p(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||q(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return X(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(i)return n?-1:X(t).length;e=(""+e).toLowerCase(),i=!0}}function m(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return L(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return x(this,e,r);case"latin1":case"binary":return I(this,e,r);case"base64":return w(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function y(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function E(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),K(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=l.from(e,n)),l.isBuffer(e))return 0===e.length?-1:_(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):_(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,e,r,n,i){let s,o=1,a=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,r/=2}function h(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let n=-1;for(s=r;s<a;s++)if(h(t,s)===h(e,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===l)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+l>a&&(r=a-l),s=r;s>=0;s--){let r=!0;for(let n=0;n<l;n++)if(h(t,s+n)!==h(e,n)){r=!1;break}if(r)return s}return-1}function b(t,e,r,n){r=Number(r)||0;const i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=e.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(e.substr(2*o,2),16);if(K(n))return o;t[r+o]=n}return o}function N(t,e,r,n){return Y(X(e,t.length-r),t,r,n)}function T(t,e,r,n){return Y(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function v(t,e,r,n){return Y(z(e),t,r,n)}function A(t,e,r,n){return Y(function(t,e){let r,n,i;const s=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function w(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);const n=[];let i=e;for(;i<r;){const e=t[i];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=r){let r,n,a,l;switch(o){case 1:e<128&&(s=e);break;case 2:r=t[i+1],128==(192&r)&&(l=(31&e)<<6|63&r,l>127&&(s=l));break;case 3:r=t[i+1],n=t[i+2],128==(192&r)&&128==(192&n)&&(l=(15&e)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:r=t[i+1],n=t[i+2],a=t[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(l=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&a,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(t){const e=t.length;if(e<=C)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=C));return r}(n)}e.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(t,e,r){return h(t,e,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(t,e,r){return function(t,e,r){return c(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},l.allocUnsafe=function(t){return u(t)},l.allocUnsafeSlow=function(t){return u(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(q(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),q(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const n=l.allocUnsafe(e);let i=0;for(r=0;r<t.length;++r){let e=t[r];if(q(e,Uint8Array))i+e.length>n.length?(l.isBuffer(e)||(e=l.from(e)),e.copy(n,i)):Uint8Array.prototype.set.call(n,e,i);else{if(!l.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,i)}i+=e.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},l.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},l.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},l.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){let t="";const r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(t,e,r,n,i){if(q(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0);const a=Math.min(s,o),h=this.slice(n,i),c=t.slice(e,r);for(let t=0;t<a;++t)if(h[t]!==c[t]){s=h[t],o=c[t];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},l.prototype.indexOf=function(t,e,r){return E(this,t,e,r,!0)},l.prototype.lastIndexOf=function(t,e,r){return E(this,t,e,r,!1)},l.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return b(this,t,e,r);case"utf8":case"utf-8":return N(this,t,e,r);case"ascii":case"latin1":case"binary":return T(this,t,e,r);case"base64":return v(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function x(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function I(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function L(t,e,r){const n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=J[t[n]];return i}function R(t,e,r){const n=t.slice(e,r);let i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}function B(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function O(t,e,r,n,i,s){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function P(t,e,r,n,i){$(e,n,i,t,r,7);let s=Number(e&BigInt(4294967295));t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,r}function U(t,e,r,n,i){$(e,n,i,t,r,7);let s=Number(e&BigInt(4294967295));t[r+7]=s,s>>=8,t[r+6]=s,s>>=8,t[r+5]=s,s>>=8,t[r+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=o,o>>=8,t[r+2]=o,o>>=8,t[r+1]=o,o>>=8,t[r]=o,r+8}function D(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(t,e,r,n,s){return e=+e,r>>>=0,s||D(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function k(t,e,r,n,s){return e=+e,r>>>=0,s||D(t,0,r,8),i.write(t,e,r,n,52,8),r+8}l.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const n=this.subarray(t,e);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let n=this[t],i=1,s=0;for(;++s<e&&(i*=256);)n+=this[t+s]*i;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},l.prototype.readUint8=l.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readBigUInt64LE=Q((function(t){j(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||W(t,this.length-8);const n=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=Q((function(t){j(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||W(t,this.length-8);const n=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let n=this[t],i=1,s=0;for(;++s<e&&(i*=256);)n+=this[t+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},l.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let n=e,i=1,s=this[t+--n];for(;n>0&&(i*=256);)s+=this[t+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},l.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readBigInt64LE=Q((function(t){j(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||W(t,this.length-8);const n=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),l.prototype.readBigInt64BE=Q((function(t){j(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||W(t,this.length-8);const n=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)})),l.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||O(this,t,e,r,Math.pow(2,8*r)-1,0);let i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||O(this,t,e,r,Math.pow(2,8*r)-1,0);let i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigUInt64LE=Q((function(t,e=0){return P(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=Q((function(t,e=0){return U(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,t,e,r,n-1,-n)}let i=0,s=1,o=0;for(this[e]=255&t;++i<r&&(s*=256);)t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+r},l.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,t,e,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+r},l.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigInt64LE=Q((function(t,e=0){return P(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=Q((function(t,e=0){return U(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(t,e,r){return M(this,t,e,!0,r)},l.prototype.writeFloatBE=function(t,e,r){return M(this,t,e,!1,r)},l.prototype.writeDoubleLE=function(t,e,r){return k(this,t,e,!0,r)},l.prototype.writeDoubleBE=function(t,e,r){return k(this,t,e,!1,r)},l.prototype.copy=function(t,e,r,n){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);const i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},l.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){const e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{const s=l.isBuffer(t)?t:l.from(t,n),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=s[i%o]}return this};const F={};function G(t,e,r){F[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function H(t){let e="",r=t.length;const n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function $(t,e,r,n,i,s){if(t>r||t<e){const n="bigint"==typeof e?"n":"";let i;throw i=s>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new F.ERR_OUT_OF_RANGE("value",i,t)}!function(t,e,r){j(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||W(e,t.length-(r+1))}(n,i,s)}function j(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function W(t,e,r){if(Math.floor(t)!==t)throw j(t,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=H(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=H(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function X(t,e){let r;e=e||1/0;const n=t.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function q(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function K(t){return t!=t}const J=function(){const t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function Q(t){return"undefined"==typeof BigInt?Z:t}function Z(){throw new Error("BigInt not supported")}},352:(t,e)=>{"use strict";var r,n,i,s;Object.defineProperty(e,"__esModule",{value:!0}),e.VOLUME=e.RATE=e.PITCH=e.OUTPUT_FORMAT=void 0,function(t){t.AUDIO_24KHZ_48KBITRATE_MONO_MP3="audio-24khz-48kbitrate-mono-mp3",t.AUDIO_24KHZ_96KBITRATE_MONO_MP3="audio-24khz-96kbitrate-mono-mp3",t.WEBM_24KHZ_16BIT_MONO_OPUS="webm-24khz-16bit-mono-opus"}(r||(e.OUTPUT_FORMAT=r={})),function(t){t.X_LOW="x-low",t.LOW="low",t.MEDIUM="medium",t.HIGH="high",t.X_HIGH="x-high",t.DEFAULT="default"}(n||(e.PITCH=n={})),function(t){t.X_SLOW="x-slow",t.SLOW="slow",t.MEDIUM="medium",t.FAST="fast",t.X_FAST="x-fast",t.DEFAULT="default"}(i||(e.RATE=i={})),function(t){t.SILENT="silent",t.X_SOFT="x-soft",t.SOFT="soft",t.MEDIUM="medium",t.LOUD="loud",t.X_LOUD="x-LOUD",t.DEFAULT="default"}(s||(e.VOLUME=s={}))},778:function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.EdgeTTSClient=e.ProsodyOptions=void 0;const i=r(287),s=r(352);void 0===globalThis.Buffer&&(globalThis.Buffer=i.Buffer);class o{constructor(){this.eventListeners={data:[],close:[],end:[]}}on(t,e){this.eventListeners[t].push(e)}emit(t,e){this.eventListeners[t].forEach((t=>t(e)))}}class a{constructor(){this.pitch="+0Hz",this.rate=1,this.volume=100}}e.ProsodyOptions=a;class l{constructor(t=!1){this.ws=null,this.voice=null,this.voiceLocale=null,this.outputFormat=null,this.requestQueue={},this.connectionStartTime=0,this.enableLogging=t,this.isBrowser="undefined"!=typeof window&&void 0!==window.document}log(...t){this.enableLogging&&console.log(...t)}sendMessage(t){return n(this,void 0,void 0,(function*(){var e,r;for(let t=1;t<=3&&(null===(e=this.ws)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN;t++)1===t&&(this.connectionStartTime=Date.now()),this.log(`Connecting... attempt ${t}`),yield this.initWebSocket();null===(r=this.ws)||void 0===r||r.send(t)}))}initWebSocket(){this.ws=new WebSocket(l.SYNTH_URL),this.ws.binaryType="arraybuffer";let t=[];return new Promise(((e,r)=>{this.ws.onopen=()=>{this.log("Connected in",(Date.now()-this.connectionStartTime)/1e3,"seconds"),this.sendMessage(this.getConfigMessage()).then(e)},this.ws.onmessage=e=>this.handleMessage(e,t),this.ws.onclose=()=>this.handleClose(),this.ws.onerror=t=>r(`Connection Error: ${t}`)}))}handleMessage(t,e){var r;const n=i.Buffer.from(t.data),s=n.toString(),o=/X-RequestId:(.*?)\r\n/.exec(s),a=o?o[1]:"";if(s.includes("Path:turn.start"))e.length=0;else if(s.includes("Path:turn.end"))null===(r=this.requestQueue[a])||void 0===r||r.emit("end",e);else if(s.includes("Path:audio"))this.cacheAudioData(n,a);else if(s.includes("Path:audio.metadata")){const t=s.indexOf("{");e.push(JSON.parse(s.slice(t)).Metadata[0])}else this.log("Unknown Message",s)}handleClose(){this.log("Disconnected after:",(Date.now()-this.connectionStartTime)/1e3,"seconds");for(const t in this.requestQueue)this.requestQueue[t].emit("close",null)}cacheAudioData(t,e){var r;const n=(new TextEncoder).encode(l.BINARY_DELIM),i=this.findDelimiterIndex(t,n);if(-1===i)return void this.log("Delimiter not found in the buffer.");const s=i+n.length,o=t.slice(s);null===(r=this.requestQueue[e])||void 0===r||r.emit("data",o),this.log("Received audio chunk of size:",null==o?void 0:o.length)}findDelimiterIndex(t,e){for(let r=0;r<=t.length-e.length;r++){let n=!0;for(let i=0;i<e.length;i++)if(t[r+i]!==e[i]){n=!1;break}if(n)return r}return-1}getConfigMessage(){return`Content-Type:application/json; charset=utf-8\r\nPath:speech.config\r\n\r\n{\n            "context": {\n                "synthesis": {\n                    "audio": {\n                        "metadataoptions": {\n                            "sentenceBoundaryEnabled": "true",\n                            "wordBoundaryEnabled": "true"\n                        },\n                        "outputFormat": "${this.outputFormat}"\n                    }\n                }\n            }\n        }`}getVoices(){return fetch(l.VOICES_URL).then((t=>t.json())).catch((t=>Promise.reject(t)))}setMetadata(t,e,r){return n(this,void 0,void 0,(function*(){if(this.voice=t,this.outputFormat=e,this.voiceLocale=r||this.inferLocaleFromVoiceName(t),!this.voiceLocale)throw new Error("Could not infer voiceLocale from voiceName!");this.ws&&this.ws.readyState===WebSocket.OPEN||(this.connectionStartTime=Date.now(),yield this.initWebSocket())}))}inferLocaleFromVoiceName(t){const e=l.VOICE_LANG_REGEX.exec(t);return e?e[0]:null}close(){var t;null===(t=this.ws)||void 0===t||t.close()}toStream(t,e=new a){return this.sendSSMLRequest(this.buildSSML(t,e))}buildSSML(t,e){return`<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="${this.voiceLocale}">\n            <voice name="${this.voice}">\n                <prosody pitch="${e.pitch}" rate="${e.rate}" volume="${e.volume}">\n                    ${t}\n                </prosody>\n            </voice>\n        </speak>`}sendSSMLRequest(t){if(!this.ws)throw new Error("WebSocket not initialized. Call setMetadata first.");const e=function(){const t=new Uint8Array(16);return window.crypto.getRandomValues(t),Array.from(t,(t=>`0${t.toString(16)}`.slice(-2))).join("")}(),r=`X-RequestId:${e}\r\nContent-Type:application/ssml+xml\r\nPath:ssml\r\n\r\n${t.trim()}`,n=new o;return this.requestQueue[e]=n,this.sendMessage(r).then(),n}}e.EdgeTTSClient=l,l.OUTPUT_FORMAT=s.OUTPUT_FORMAT,l.CLIENT_TOKEN="6A5AA1D4EAFF4E9FB37E23D68491D6F4",l.VOICES_URL=`https://speech.platform.bing.com/consumer/speech/synthesize/readaloud/voices/list?trustedclienttoken=${l.CLIENT_TOKEN}`,l.SYNTH_URL=`wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1?TrustedClientToken=${l.CLIENT_TOKEN}`,l.BINARY_DELIM="Path:audio\r\n",l.VOICE_LANG_REGEX=/\w{2}-\w{2}/},361:(t,e,r)=>{"use strict";e.cm=e.NA=e.gU=void 0;var n=r(778);Object.defineProperty(e,"gU",{enumerable:!0,get:function(){return n.EdgeTTSClient}});var i=r(778);Object.defineProperty(e,"NA",{enumerable:!0,get:function(){return i.ProsodyOptions}});var s=r(352);Object.defineProperty(e,"cm",{enumerable:!0,get:function(){return s.OUTPUT_FORMAT}})},251:(t,e)=>{e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=r?i-1:0,f=r?-1:1,d=t[e+u];for(u+=f,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+t[e+u],u+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+t[e+u],u+=f,c-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=h}return(d?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,l,h=8*s-i-1,c=(1<<h)-1,u=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,g=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+u>=1?f/l:f*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*l-1)*Math.pow(2,i),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&a,d+=g,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[r+d]=255&o,d+=g,o/=256,h-=8);t[r+d-g]|=128*p}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";var t=r(361),e=r(396);class n{static splitIntoSentences(t){return((t=t.replace(/\s+/g," ").trim()).match(/[^.!?]+(?:[.!?]+(?:(?=[A-Z][a-z])|$|\s))/g)||[]).map(((t,e)=>{const r=t.trim();return{text:r,index:e,isHeading:n.isHeading(r)}})).filter((t=>t.text.length>0))}static isHeading(t){return/^[A-Z0-9\s.,!?-]+$/.test(t)||/^.{1,50}:$/.test(t)||/^\d+\.\s+.{1,50}$/.test(t)}static extractTextContent(t){if("string"==typeof t){if(t.trim().startsWith("<")){const e=(new DOMParser).parseFromString(t,"text/html");return n.extractTextContent(e.body)}return t.trim()}let e="";const r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:function(t){const e=t.parentElement;return"SCRIPT"===e?.tagName||"STYLE"===e?.tagName?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let i;for(;i=r.nextNode();)e+=(i.textContent||"")+" ";return e.trim()}}new class{constructor(){this.ttsClient=null,this.audioContext=null,this.sourceNode=null,this.audioChunks=[],this.isPlaying=!1,this.isPaused=!1,this.currentSentenceIndex=0,this.sentences=[],this.currentStream=null,this.currentVoice=null,this.currentSpeed=null,this.excludeSelectors=["select","textarea","button","label","audio","video","dialog","embed","menu",'nav:not([role="main"])',"noframes","noscript","object","script","style","svg","aside","footer","#footer",".no-read-aloud",'[aria-hidden="true"]','[role="complementary"]',"sup",'[style*="float: right"]','[style*="position: fixed"]'].join(","),this.blockElements=new Set(["p","div","h1","h2","h3","h4","h5","h6","article","section","blockquote","li","td","th","dd","dt","figcaption","pre","address"]),this.setupMessageListener()}setupMessageListener(){chrome.runtime.onMessage.addListener(((t,e,r)=>{console.log("Content script received message:",t);try{switch(t.action){case"startReading":void 0!==t.startFromIndex?this.readFromIndex(t.startFromIndex).then((()=>r({status:"success"}))).catch((t=>{console.error("Start reading from index error:",t),r({status:"error",error:t instanceof Error?t.message:String(t)})})):this.startReading(t.voice,t.speed).then((()=>r({status:"success"}))).catch((t=>{console.error("Start reading error:",t),r({status:"error",error:t instanceof Error?t.message:String(t)})}));break;case"readFromIndex":"number"==typeof t.index?this.readFromIndex(t.index).then((()=>r({status:"success"}))).catch((t=>{console.error("Read from index error:",t),r({status:"error",error:t instanceof Error?t.message:String(t)})})):(console.error("Invalid index type:",t.index),r({status:"error",error:"Invalid index type"}));break;case"readSelection":const e=window.getSelection()?.toString().trim();e?this.startReadingText(e,void 0,void 0).then((()=>r({status:"success"}))).catch((t=>{console.error("Read selection error:",t),r({status:"error",error:t instanceof Error?t.message:String(t)})})):r({status:"error",error:"No text selected"});break;case"stopReading":try{this.stopReading(t.closeReader),this.currentSentenceIndex=0,r({status:"success"})}catch(t){console.error("Stop reading error:",t),r({status:"error",error:"Failed to stop reading"})}break;case"pauseReading":try{this.pauseReading(),r({status:"success"})}catch(t){console.error("Pause reading error:",t),r({status:"error",error:"Failed to pause reading"})}break;case"resumeReading":this.resumeReading().then((()=>r({status:"success"}))).catch((t=>{console.error("Resume reading error:",t),r({status:"error",error:t instanceof Error?t.message:String(t)})}))}}catch(t){console.error("Message handling error:",t),r({status:"error",error:"Failed to process message"})}return!0}))}async startReading(t,e){try{this.stopReading();const r=this.parsePageContent();if(!r)throw new Error("Could not parse page content");const i=n.extractTextContent(r.content);this.sentences=n.splitIntoSentences(i),console.log("Initialized sentences array:",this.sentences.length);const s=this.formatArticleContent(r,this.sentences),o=await chrome.runtime.sendMessage({action:"openReader",text:s,title:r.title,metadata:{author:r.byline,siteName:r.siteName,excerpt:r.excerpt}});if("error"===o?.status)throw new Error(o.error);await new Promise((t=>setTimeout(t,1e3))),await this.startReadingText(i,t,e)}catch(t){const e=t instanceof Error?t.message:"An unknown error occurred";throw console.error("Failed to start reading:",e),chrome.runtime.sendMessage({action:"updateReaderContent",error:e}),new Error(e)}}parsePageContent(){try{const t=document.cloneNode(!0),r=new e.Readability(t,{keepClasses:!0,classesToPreserve:["chapter","article","section","title"]}).parse();if(r&&r.content){const t=n.extractTextContent(r.content);return{...r,textContent:t}}return r}catch(t){return console.error("Error parsing page content:",t),null}}formatArticleContent(t,e){let r="";return t.title&&(r+=`<h1>${t.title}</h1>\n\n`),(t.byline||t.siteName)&&(r+='<div class="article-metadata">\n',t.byline&&(r+=`<p class="author">By ${t.byline}</p>\n`),t.siteName&&(r+=`<p class="site-name">From ${t.siteName}</p>\n`),r+="</div>\n\n"),r+='<div class="reader-text">\n',e.forEach(((t,e)=>{r+=`<span data-sentence-index="${e}">${t.text} </span>`})),r+="</div>\n",r}async startReadingText(t,e,r){try{if(console.log("Starting to read text:",{contentType:"string"==typeof t?"string":"HTMLElement",voice:e,speed:r}),e&&r)this.currentVoice=e,this.currentSpeed=r;else{const t=await this.getSettings();this.currentVoice=e||t.voice,this.currentSpeed=r||t.speed}const i=n.extractTextContent(t);this.sentences=n.splitIntoSentences(i),console.log("Split text into sentences:",this.sentences.length),this.currentSentenceIndex=0,this.isPaused=!1,this.isPlaying=!0,await this.readNextSentence(this.currentVoice,this.currentSpeed)}catch(t){throw console.error("TTS Error:",t),this.isPlaying=!1,t}}async readFromIndex(e){if(console.log("=== Read From Index Debug ==="),console.log("Requested index:",e),0===this.sentences.length)throw console.error("No sentences available to read from"),new Error("No sentences available to read from");if(e>=this.sentences.length)throw console.error("Index out of bounds:",e,"Total sentences:",this.sentences.length),new Error("Index out of bounds");await this.stopCurrentReading();try{if(this.audioContext||(this.audioContext=new AudioContext),await this.audioContext.resume(),this.ttsClient||(this.ttsClient=new t.gU),!this.currentVoice||!this.currentSpeed){const t=await this.getSettings();this.currentVoice=t.voice,this.currentSpeed=t.speed}this.currentSentenceIndex=e,this.isPlaying=!0,this.isPaused=!1,console.log("Starting to read from sentence:",{index:this.currentSentenceIndex,text:this.sentences[this.currentSentenceIndex].text}),await this.readNextSentence(this.currentVoice,this.currentSpeed)}catch(t){throw console.error("Failed to start reading from index:",t),await this.stopCurrentReading(),t}}async stopCurrentReading(){if(console.log("Stopping current reading..."),this.sourceNode){try{this.sourceNode.stop(),this.sourceNode.disconnect()}catch(t){console.error("Error stopping current audio:",t)}this.sourceNode=null}if(this.currentStream){try{"function"==typeof this.currentStream.removeListener&&["data","end","error"].forEach((t=>{try{this.currentStream.removeListener(t)}catch(e){console.error(`Error removing ${t} listener:`,e)}}))}catch(t){console.error("Error cleaning up stream:",t)}this.currentStream=null}if(this.audioContext)try{await this.audioContext.close(),this.audioContext=null}catch(t){console.error("Error closing audio context:",t)}this.ttsClient&&(this.ttsClient.close(),this.ttsClient=null),this.audioChunks=[],this.isPlaying=!1,this.isPaused=!1,await new Promise((t=>setTimeout(t,100)))}async readNextSentence(t,e){if(this.isPaused||!this.isPlaying||this.currentSentenceIndex>=this.sentences.length)return console.log("ReadNextSentence early return:",{isPaused:this.isPaused,isPlaying:this.isPlaying,currentIndex:this.currentSentenceIndex,totalSentences:this.sentences.length}),void(this.currentSentenceIndex>=this.sentences.length&&this.stopReading(!0));const r=this.sentences[this.currentSentenceIndex];console.log("Reading sentence:",{index:this.currentSentenceIndex,text:r.text,isHeading:r.isHeading});try{await chrome.runtime.sendMessage({action:"updateReaderHighlight",index:this.currentSentenceIndex,text:r.text}),await this.readSentence(r.text,t,e),await new Promise((t=>setTimeout(t,250))),!this.isPaused&&this.isPlaying&&(this.currentSentenceIndex++,await this.readNextSentence(t,e))}catch(t){const e=t instanceof Error?t.message:"An unknown error occurred";console.error("Error reading sentence:",e),this.stopReading(!0)}}async readSentence(e,r,n){return new Promise((async(i,s)=>{try{this.ttsClient||(console.log("Creating new TTS client"),this.ttsClient=new t.gU),this.audioContext||(console.log("Creating new AudioContext"),this.audioContext=new AudioContext);const o=this.audioContext;if(!o)throw new Error("Failed to create audio context");"running"!==o.state&&(console.log("Resuming audio context"),await o.resume());let a=i;const l=()=>{if(this.sourceNode){try{this.sourceNode.stop(),this.sourceNode.disconnect()}catch(t){console.error("Error cleaning up audio:",t)}this.sourceNode=null}};console.log("Setting TTS metadata:",{voice:r}),await this.ttsClient.setMetadata(r,t.cm.AUDIO_24KHZ_48KBITRATE_MONO_MP3);const h=new t.NA;h.rate=n,console.log("TTS options:",h),this.audioChunks=[];const c=[];console.log("Starting TTS stream for text:",e);const u=this.ttsClient.toStream(e,h);if(this.currentStream=u,!u||"function"!=typeof u.on)throw new Error("Invalid stream object");u.on("data",(t=>{if(this.isPaused)return l(),void a();c.push(t)})),u.on("end",(async()=>{if(this.isPaused)return l(),void a();if(0===c.length)return console.error("Stream ended without receiving any data"),void s(new Error("No audio data received"));try{const t=c.reduce(((t,e)=>t+e.length),0),e=new Uint8Array(t);let r=0;for(const t of c)e.set(t,r),r+=t.length;const n=await o.decodeAudioData(e.buffer);if(this.isPaused)return l(),void a();const i=o.createBufferSource();i.buffer=n,i.connect(o.destination),this.sourceNode=i,i.onended=()=>{this.sourceNode=null,a()},i.start()}catch(t){console.error("Audio playback error:",t),s(t)}}))}catch(t){console.error("Error reading sentence:",t),s(t instanceof Error?t:new Error("Unknown error"))}}))}async resumeReading(){if(console.log("Resuming playback from sentence index:",this.currentSentenceIndex),!this.currentVoice||!this.currentSpeed){const t=await this.getSettings();this.currentVoice=t.voice,this.currentSpeed=t.speed}this.isPaused=!1,this.isPlaying=!0,await this.readNextSentence(this.currentVoice,this.currentSpeed)}pauseReading(){if(console.log("Pausing playback"),this.isPaused=!0,this.sourceNode){try{this.sourceNode.stop(),this.sourceNode.disconnect()}catch(t){console.error("Error stopping audio:",t)}this.sourceNode=null}this.audioChunks=[],console.log("Paused at sentence index:",this.currentSentenceIndex)}async getSettings(){return new Promise(((t,e)=>{chrome.runtime.sendMessage({action:"getSettings"},(r=>{chrome.runtime.lastError?e(chrome.runtime.lastError):t(r||{voice:"en-US-AvaNeural",speed:1})}))}))}stopReading(t=!1,e=!1){if(console.log("Stopping playback, keepState:",e),this.isPaused=!1,this.isPlaying=!1,e||(this.currentVoice=null,this.currentSpeed=null,this.currentSentenceIndex=0,this.sentences=[]),this.sourceNode){try{this.sourceNode.stop(),this.sourceNode.disconnect()}catch(t){console.error("Error stopping audio:",t)}this.sourceNode=null}if(this.audioContext&&(this.audioContext.close().catch(console.error),this.audioContext=null),this.ttsClient&&(this.ttsClient.close(),this.ttsClient=null),this.audioChunks=[],this.currentStream){try{"function"==typeof this.currentStream.removeListener&&["data","end","error"].forEach((t=>{try{this.currentStream.removeListener(t)}catch(e){console.error(`Error removing ${t} listener:`,e)}}))}catch(t){console.error("Error cleaning up stream:",t)}this.currentStream=null}e||chrome.runtime.sendMessage({action:"readingStopped",closeReader:t}).catch(console.error)}}})()})();